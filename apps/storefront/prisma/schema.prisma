generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Address {
  id         String   @id
  country    String   @default("IRI")
  address    String
  city       String
  phone      String
  postalCode String
  userId     String
  createdAt  DateTime @default(now())
  User       User     @relation(fields: [userId], references: [id])
  Order      Order[]

  @@index([userId])
}

model Author {
  id         String   @id
  email      String   @unique
  phone      String?  @unique
  name       String?
  avatar     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  supabaseId String?  @unique
  Blog       Blog[]
}

model Banner {
  id         String    @id
  label      String
  image      String
  categoryId String?
  category   Category? @relation("BannerCategory", fields: [categoryId], references: [id])
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  isArchived Boolean   @default(false)

  @@index([categoryId])
}

model Blog {
  slug        String   @id
  title       String
  image       String
  description String
  content     String?
  categories  String[]
  keywords    String[]
  authorId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  author      Author   @relation(fields: [authorId], references: [id])

  @@index([authorId])
}

model Brand {
  id          String    @id
  title       String    @unique
  description String?
  color       String?   @default("#3B82F6")
  products    Product[]
}

model Cart {
  userId    String     @id
  createdAt DateTime   @default(now())
  updatedAt DateTime
  User      User       @relation(fields: [userId], references: [id])
  CartItem  CartItem[]
}

model CartItem {
  cartId    String
  productId String
  count     Int
  Cart      Cart    @relation(fields: [cartId], references: [userId])
  Product   Product @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
}

model Category {
  id            String         @id
  title         String         @unique
  description   String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  isArchived    Boolean        @default(false)
  categoryItems CategoryItem[]
  banners       Banner[]       @relation("BannerCategory")
  products      Product[]
}

model CategoryItem {
  id               String             @id
  name             String
  description      String?
  skuPattern       String?
  basePrice        Decimal?
  categoryId       String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  isArchived       Boolean            @default(false)
  Category         Category           @relation(fields: [categoryId], references: [id])
  Product          Product[]
  ProductAttribute ProductAttribute[]
  ProductSize      ProductSize[]
  ProductZone      ProductZone[]

  @@unique([categoryId, name])
}

model DiscountCode {
  id                String   @id
  code              String   @unique
  stock             Int      @default(1)
  description       String?
  percent           Int
  maxDiscountAmount Float    @default(1)
  startDate         DateTime
  endDate           DateTime
  createdAt         DateTime @default(now())
  Order             Order[]
}

model Error {
  id        String   @id
  error     String
  userId    String?
  createdAt DateTime @default(now())
  User      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
}

model File {
  id        String   @id
  url       String
  userId    String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Notification {
  id        String   @id
  content   String
  isRead    Boolean  @default(false)
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Order {
  id             String          @id
  number         Int             @unique @default(autoincrement())
  status         OrderStatusEnum
  total          Float           @default(100)
  shipping       Float           @default(100)
  payable        Float           @default(100)
  tax            Float           @default(100)
  discount       Float           @default(0)
  isPaid         Boolean         @default(false)
  isCompleted    Boolean         @default(false)
  discountCodeId String?
  addressId      String?
  userId         String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  isArchived     Boolean         @default(false)
  Address        Address?        @relation(fields: [addressId], references: [id])
  DiscountCode   DiscountCode?   @relation(fields: [discountCodeId], references: [id])
  User           User            @relation(fields: [userId], references: [id])
  OrderItem      OrderItem[]
  Payment        Payment[]
  Refund         Refund?

  @@index([addressId])
  @@index([discountCodeId])
  @@index([userId])
}

model OrderItem {
  orderId   String
  productId String
  count     Int
  price     Float
  discount  Float
  Order     Order   @relation(fields: [orderId], references: [id])
  Product   Product @relation(fields: [productId], references: [id])

  @@unique([orderId, productId])
}

model Owner {
  id         String   @id
  email      String   @unique
  phone      String?  @unique
  name       String?
  avatar     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  supabaseId String?  @unique
}

model Payment {
  id              String            @id
  number          Int               @unique @default(autoincrement())
  status          PaymentStatusEnum
  refId           String            @unique
  cardPan         String?
  cardHash        String?
  fee             Float?
  isSuccessful    Boolean           @default(false)
  payable         Float
  providerId      String
  userId          String
  orderId         String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Order           Order             @relation(fields: [orderId], references: [id])
  PaymentProvider PaymentProvider   @relation(fields: [providerId], references: [id])
  User            User              @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([providerId])
  @@index([userId])
}

model PaymentProvider {
  id          String    @id
  title       String    @unique
  description String?
  websiteUrl  String?
  isActive    Boolean   @default(false)
  Payment     Payment[]
}

model Product {
  id              String          @id
  title           String
  description     String?
  images          String[]
  keywords        String[]
  metadata        Json?
  price           Float           @default(100)
  discount        Float           @default(0)
  stock           Int             @default(0)
  isPhysical      Boolean         @default(true)
  isAvailable     Boolean         @default(false)
  isFeatured      Boolean         @default(false)
  brandId         String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  height          Float?
  length          Float?
  weight          Float?
  width           Float?
  isArchived      Boolean         @default(false)
  categoryItemId  String?
  isCustomizable  Boolean         @default(true)
  isPrintOnDemand Boolean         @default(false)
  cartItems       CartItem[]
  orders          OrderItem[]
  brand           Brand           @relation(fields: [brandId], references: [id])
  categoryItem    CategoryItem?   @relation(fields: [categoryItemId], references: [id])
  productReviews  ProductReview[]
  categories      Category[]
  wishlists       User[]          @relation("Wishlist")
  customizationRequests CustomizationRequest[]

  @@index([brandId])
  @@index([categoryItemId])
}

model ProductAttribute {
  id             String       @id
  name           String
  type           String
  required       Boolean      @default(false)
  categoryItemId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  options        Json?
  CategoryItem   CategoryItem @relation(fields: [categoryItemId], references: [id])
}

model ProductPrintSize {
  id            String      @id
  name          String
  width         Int
  height        Int
  reference     String
  area          Float
  productZoneId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime
  costPerMeter  Float       @default(0)
  printingCost  Float       @default(0)
  ProductZone   ProductZone @relation(fields: [productZoneId], references: [id])
}

model ProductReview {
  id        String   @id
  text      String
  rating    Int
  productId String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  Product   Product  @relation(fields: [productId], references: [id])
  User      User     @relation(fields: [userId], references: [id])

  @@unique([productId, userId])
  @@index([productId])
  @@index([userId])
}

model ProductSize {
  id             String       @id
  name           String
  code           String?
  displayOrder   Int          @default(0)
  categoryItemId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  stock          Int          @default(0)
  CategoryItem   CategoryItem @relation(fields: [categoryItemId], references: [id])
}

model ProductZone {
  id               String             @id
  name             String
  code             String?
  displayOrder     Int                @default(0)
  categoryItemId   String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  ProductPrintSize ProductPrintSize[]
  CategoryItem     CategoryItem       @relation(fields: [categoryItemId], references: [id])
}

model Refund {
  id        String   @id
  amount    Float
  reason    String
  orderId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  Order     Order    @relation(fields: [orderId], references: [id])

  @@index([orderId])
}

model User {
  id                       String          @id
  email                    String?         @unique
  phone                    String?         @unique
  name                     String?
  birthday                 String?
  emailUnsubscribeToken    String?         @unique
  referralCode             String?         @unique
  isBanned                 Boolean         @default(false)
  isEmailVerified          Boolean         @default(false)
  isPhoneVerified          Boolean         @default(false)
  isEmailSubscribed        Boolean         @default(false)
  isPhoneSubscribed        Boolean         @default(false)
  createdAt                DateTime        @default(now())
  updatedAt                DateTime
  supabaseId               String?         @unique
  avatarUrl                String?
  emailVerificationExpires DateTime?
  emailVerificationToken   String?         @unique
  Address                  Address[]
  Cart                     Cart?
  Error                    Error[]
  File                     File[]
  Notification             Notification[]
  Order                    Order[]
  Payment                  Payment[]
  ProductReview            ProductReview[]
  Product                  Product[]       @relation("Wishlist")
  CustomizationRequest     CustomizationRequest[]
}

enum OrderStatusEnum {
  Processing
  Shipped
  Delivered
  ReturnProcessing
  ReturnCompleted
  Cancelled
  RefundProcessing
  RefundCompleted
  Denied
}

enum PaymentStatusEnum {
  Processing
  Paid
  Failed
  Denied
}

model CustomizationRequest {
  id           String   @id @default(cuid())
  productId    String
  product      Product  @relation(fields: [productId], references: [id])
  zoneId       String
  sizeId       String?
  quantity     Int      @default(1)
  designImages String[]
  notes        String?
  userId       String?
  user         User?    @relation(fields: [userId], references: [id])
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([productId])
  @@index([userId])
}
